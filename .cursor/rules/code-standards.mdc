---
description:
globs:
alwaysApply: false
---
# ğŸ› ï¸ ä»£ç è§„èŒƒå’Œæœ€ä½³å®è·µ

## Flutter/Dart ä»£ç è§„èŒƒ

### å‘½åè§„èŒƒ
- **ç±»å**: å¤§é©¼å³°å‘½åæ³• (PascalCase)
  ```dart
  class GameProvider extends ChangeNotifier {}
  ```
- **å˜é‡å’Œæ–¹æ³•**: å°é©¼å³°å‘½åæ³• (camelCase)
  ```dart
  int targetScore = 1000;
  void resetGame() {}
  ```
- **å¸¸é‡**: å°é©¼å³°å‘½åæ³•
  ```dart
  const double tileSize = 64.0;
  ```
- **ç§æœ‰æˆå‘˜**: ä¸‹åˆ’çº¿å‰ç¼€
  ```dart
  bool _isAnimating = false;
  void _processMatches() {}
  ```

### Widget è®¾è®¡åŸåˆ™

#### 1. ä½¿ç”¨ const æ„é€ å‡½æ•°
```dart
// âœ… æ¨è
class GameInfoPanel extends StatelessWidget {
  const GameInfoPanel({super.key});
}

// âŒ é¿å…
class GameInfoPanel extends StatelessWidget {
  GameInfoPanel({Key? key}) : super(key: key);
}
```

#### 2. æå–å¤æ‚ç»„ä»¶
å‚è€ƒ [lib/widgets/pet_tile_widget.dart](mdc:lib/widgets/pet_tile_widget.dart) ä¸­çš„ AnimatedPetTileWidget å®ç°

#### 3. ä½¿ç”¨ RepaintBoundary ä¼˜åŒ–é‡ç»˜
```dart
Widget _buildGameGrid() {
  return RepaintBoundary(
    child: GridView.builder(...)
  );
}
```

### çŠ¶æ€ç®¡ç†è§„èŒƒ

#### Provider ä½¿ç”¨
å‚è€ƒ [lib/providers/game_provider.dart](mdc:lib/providers/game_provider.dart) çš„å®ç°ï¼š

1. **ç²¾ç¡®ç›‘å¬**
```dart
// âœ… æ¨è - ä½¿ç”¨ Consumer
Consumer<GameProvider>(
  builder: (context, gameProvider, child) {
    return Text('${gameProvider.score}');
  },
)

// âŒ é¿å… - ç›‘å¬æ•´ä¸ª Provider
context.watch<GameProvider>()
```

2. **æ‰¹é‡çŠ¶æ€æ›´æ–°**
```dart
void updateMultipleStates() {
  // æ‰¹é‡æ›´æ–°åç»Ÿä¸€é€šçŸ¥
  _score += 100;
  _moves--;
  notifyListeners(); // åªè°ƒç”¨ä¸€æ¬¡
}
```

### å¼‚æ­¥ç¼–ç¨‹è§„èŒƒ

#### 1. ä½¿ç”¨ async/await æ›¿ä»£åµŒå¥—å›è°ƒ
```dart
// âœ… æ¨è
Future<void> processMatches() async {
  await animateMatches();
  await dropTiles();
  await fillEmptySpaces();
}

// âŒ é¿å…åµŒå¥—å›è°ƒ
void processMatches() {
  animateMatches().then((_) {
    dropTiles().then((_) {
      fillEmptySpaces();
    });
  });
}
```

#### 2. æ£€æŸ¥ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ
```dart
Future<void> loadData() async {
  final data = await apiCall();
  if (mounted) { // æ£€æŸ¥ç»„ä»¶æ˜¯å¦ä»ç„¶å­˜åœ¨
    setState(() {
      this.data = data;
    });
  }
}
```

### èµ„æºç®¡ç†è§„èŒƒ

#### åŠ¨ç”»æ§åˆ¶å™¨ç®¡ç†
å‚è€ƒ [lib/main.dart](mdc:lib/main.dart) ä¸­çš„å®ç°ï¼š

```dart
class _GameScreenState extends State<GameScreen>
    with TickerProviderStateMixin {
  late AnimationController _controller;
  
  @override
  void initState() {
    super.initState();
    _controller = AnimationController(vsync: this, ...);
  }
  
  @override
  void dispose() {
    _controller.dispose(); // å¿…é¡»é‡Šæ”¾èµ„æº
    super.dispose();
  }
}
```

### æ€§èƒ½ä¼˜åŒ–è§„èŒƒ

#### 1. å¯¹è±¡æ± æ¨¡å¼
```dart
class TilePool {
  static final Queue<PetTile> _pool = Queue<PetTile>();
  
  static PetTile acquire(...) {
    if (_pool.isNotEmpty) {
      return _pool.removeFirst();
    }
    return PetTile(...);
  }
  
  static void release(PetTile tile) {
    _pool.add(tile);
  }
}
```

#### 2. é¿å…ä¸å¿…è¦çš„é‡å»º
```dart
// âœ… ä½¿ç”¨ ValueKey æä¾›ç¨³å®šæ ‡è¯†
ListView.builder(
  itemBuilder: (context, index) {
    return GameTile(
      key: ValueKey('${tile.row}-${tile.col}'),
      tile: tile,
    );
  },
)
```

### é”™è¯¯å¤„ç†è§„èŒƒ

#### 1. è¾¹ç•Œæ£€æŸ¥
```dart
bool _hasMatchAt(int row, int col) {
  // å¿…é¡»å…ˆæ£€æŸ¥è¾¹ç•Œ
  if (row < 0 || row >= gridSize || col < 0 || col >= gridSize) {
    return false;
  }
  // å†è¿›è¡Œä¸šåŠ¡é€»è¾‘
}
```

#### 2. å¼‚å¸¸æ•è·
```dart
Future<void> processMatches() async {
  try {
    await _animateMatches();
    // ä¸šåŠ¡é€»è¾‘
  } catch (e) {
    debugPrint('åŒ¹é…å¤„ç†å¼‚å¸¸: $e');
    // é”™è¯¯æ¢å¤é€»è¾‘
  } finally {
    _isProcessing = false;
  }
}
```

### ä»£ç æ³¨é‡Šè§„èŒƒ

#### 1. æ–‡æ¡£æ³¨é‡Š
```dart
/// æ¸¸æˆçŠ¶æ€ç®¡ç†çš„æ ¸å¿ƒç±»
/// 
/// è´Ÿè´£å¤„ç†æ¸¸æˆé€»è¾‘ã€çŠ¶æ€ç®¡ç†å’ŒåŠ¨ç”»æ§åˆ¶
class GameProvider extends ChangeNotifier {
  /// å½“å‰æ¸¸æˆåˆ†æ•°
  int get score => _score;
  
  /// é‡ç½®æ¸¸æˆåˆ°åˆå§‹çŠ¶æ€
  /// 
  /// è¿™å°†æ¸…é™¤æ‰€æœ‰è¿›åº¦å¹¶é‡æ–°ç”Ÿæˆæ¸¸æˆç½‘æ ¼
  void resetGame() {
    // å®ç°...
  }
}
```

#### 2. åŠŸèƒ½æ³¨é‡Š
```dart
// ğŸ¯ åŒ¹é…æ£€æµ‹ç®—æ³• - é«˜æ•ˆå®ç°ï¼Œæ·»åŠ è¾¹ç•Œæ£€æŸ¥
bool _hasMatchAt(int row, int col) {
  // è¾¹ç•Œæ£€æŸ¥
  if (!_isValidPosition(row, col)) return false;
  
  // æ°´å¹³åŒ¹é…æ£€æµ‹
  final horizontalCount = _countHorizontalMatches(row, col, petType);
  
  // å‚ç›´åŒ¹é…æ£€æµ‹  
  final verticalCount = _countVerticalMatches(row, col, petType);
}
```

### æµ‹è¯•è§„èŒƒ

#### å•å…ƒæµ‹è¯•
å‚è€ƒ [test/](mdc:test/) ç›®å½•ç»“æ„ï¼š

```dart
// æ¨¡å‹æµ‹è¯•
test('should create tile with correct properties', () {
  final tile = PetTile(row: 0, col: 1, petType: PetType.cat);
  
  expect(tile.row, 0);
  expect(tile.col, 1);
  expect(tile.petType, PetType.cat);
});
```

#### Widget æµ‹è¯•
```dart
testWidgets('should display pet emoji', (WidgetTester tester) async {
  await tester.pumpWidget(
    MaterialApp(
      home: GameTile(tile: tile, onTap: () {}),
    ),
  );
  
  expect(find.text('ğŸ±'), findsOneWidget);
});
```
